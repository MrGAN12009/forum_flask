# Руководство по тестированию

Инструкции по тестированию различных компонентов форума.

## Ручное тестирование

### 1. Регистрация и авторизация

#### Регистрация

**Позитивные тесты:**
```
1. Перейти на /auth/register
2. Заполнить форму корректными данными:
   - Username: testuser1
   - Email: test1@example.com
   - Password: password123
   - Confirm: password123
3. Нажать "Зарегистрироваться"
✓ Ожидается: редирект на /auth/login, сообщение об успехе
```

**Негативные тесты:**
```
1. Короткое имя (< 3 символов) → ошибка
2. Невалидный email → ошибка
3. Короткий пароль (< 6 символов) → ошибка
4. Пароли не совпадают → ошибка
5. Существующий username → ошибка
6. Существующий email → ошибка
```

#### Вход

**Позитивные тесты:**
```
1. Перейти на /auth/login
2. Ввести email и пароль зарегистрированного пользователя
3. Нажать "Войти"
✓ Ожидается: редирект на главную, пользователь авторизован
```

**Негативные тесты:**
```
1. Неверный email → ошибка
2. Неверный пароль → ошибка
3. Несуществующий пользователь → ошибка
```

#### Выход

```
1. Будучи авторизованным, нажать "Выход"
✓ Ожидается: редирект на главную, пользователь разлогинен
```

### 2. Форум

#### Просмотр топиков

```
1. Перейти на /forum
✓ Ожидается: список топиков с пагинацией
✓ Показываются: заголовок, автор, дата, количество постов, просмотры
```

#### Создание топика

**Позитивные тесты:**
```
1. Авторизоваться
2. Перейти на /forum/topic/create
3. Заполнить форму:
   - Title: "Тестовый топик"
   - Content: "Это содержание тестового топика..."
4. Нажать "Создать топик"
✓ Ожидается: редирект на топик, топик создан
```

**Негативные тесты:**
```
1. Попытка создать без авторизации → редирект на логин
2. Слишком короткий заголовок (< 5) → ошибка
3. Слишком короткое содержание (< 10) → ошибка
```

#### Просмотр топика

```
1. Перейти на /forum/topic/1
✓ Ожидается: 
   - Показан топик с заголовком и содержанием
   - Показан автор с аватаром
   - Показаны посты
   - Увеличен счетчик просмотров
   - Форма для ответа (если авторизован)
```

#### Создание поста

**Позитивные тесты:**
```
1. Авторизоваться
2. Перейти на топик
3. Заполнить форму ответа
4. (Опционально) Прикрепить изображение
5. Нажать "Отправить"
✓ Ожидается: пост добавлен, страница обновлена
```

**Тест загрузки изображения:**
```
1. Прикрепить JPG/PNG/GIF изображение < 16MB
✓ Ожидается: изображение загружено и показывается в посте

2. Прикрепить файл другого типа
✓ Ожидается: ошибка или игнорирование

3. Прикрепить файл > 16MB
✓ Ожидается: ошибка размера файла
```

#### Удаление поста

```
1. Авторизоваться как автор поста
2. Нажать кнопку удаления
3. Подтвердить
✓ Ожидается: пост удален

4. Попытаться удалить чужой пост
✓ Ожидается: ошибка доступа
```

### 3. Чат

#### Список чатов

```
1. Авторизоваться
2. Перейти на /chat
✓ Ожидается:
   - Список пользователей с активными чатами
   - Список всех пользователей для начала нового чата
```

#### Чат с пользователем

**WebSocket подключение:**
```
1. Открыть DevTools → Network → WS
2. Перейти в чат с пользователем
✓ Ожидается: WebSocket соединение установлено
```

**Отправка сообщения:**
```
1. Ввести текст
2. Нажать "Отправить"
✓ Ожидается:
   - Сообщение добавлено в чат
   - У другого пользователя появляется в реальном времени
   - Счетчик непрочитанных обновлен
```

**Отправка изображения:**
```
1. Выбрать изображение
2. Проверить превью
3. Отправить
✓ Ожидается: изображение показывается в чате
```

**Индикатор печати:**
```
1. Откройте чат с двух аккаунтов
2. Начните печатать на одном
✓ Ожидается: на другом появляется "печатает..."
```

**Непрочитанные сообщения:**
```
1. Пользователь A отправляет сообщение B
2. У B в навигации появляется счетчик
3. B открывает чат
✓ Ожидается: счетчик обнуляется, сообщения помечены прочитанными
```

### 4. Профиль

#### Просмотр профиля

```
1. Перейти на /profile/1
✓ Ожидается:
   - Аватар, имя, email, дата регистрации
   - Статистика (топики, посты)
   - Последние топики
   - Последние посты
   - Кнопка "Написать сообщение" (для чужого профиля)
   - Кнопки редактирования (для своего профиля)
```

#### Редактирование профиля

**Изменение имени:**
```
1. Перейти на /profile/edit
2. Изменить username
3. Сохранить
✓ Ожидается: имя изменено
```

**Загрузка аватара:**
```
1. Выбрать изображение
2. Проверить превью
3. Сохранить
✓ Ожидается:
   - Аватар загружен
   - Размер изменен до 200x200
   - Старый аватар удален (если не дефолтный)
```

**Негативные тесты:**
```
1. Попытка установить занятое имя → ошибка
2. Слишком короткое имя → ошибка
```

#### Смена пароля

```
1. Перейти на /profile/change-password
2. Ввести текущий пароль
3. Ввести новый пароль
4. Подтвердить новый пароль
5. Сохранить
✓ Ожидается: пароль изменен, можно войти с новым паролем
```

**Негативные тесты:**
```
1. Неверный текущий пароль → ошибка
2. Слишком короткий новый пароль → ошибка
3. Пароли не совпадают → ошибка
```

## Тестирование безопасности

### CSRF

```
1. Попытаться отправить форму без CSRF токена
✓ Ожидается: ошибка 403 или 400
```

### SQL Injection

```
1. Попытаться ввести в форму: ' OR '1'='1
✓ Ожидается: данные экранированы, SQL injection не работает
```

### XSS

```
1. Попытаться ввести: <script>alert('XSS')</script>
✓ Ожидается: скрипт не выполняется, показывается как текст
```

### Защита маршрутов

```
1. Выйти из системы
2. Попытаться открыть /forum/topic/create
✓ Ожидается: редирект на /auth/login

3. Попытаться открыть /chat
✓ Ожидается: редирект на /auth/login

4. Попытаться открыть /profile/edit
✓ Ожидается: редирект на /auth/login
```

### Права доступа

```
1. Попытаться удалить чужой пост
✓ Ожидается: ошибка доступа

2. Попытаться отредактировать чужой профиль
✓ Ожидается: ошибка доступа (если реализовано)
```

## Тестирование производительности

### Нагрузочное тестирование

#### Используя Apache Bench:

```bash
# Тест главной страницы
ab -n 1000 -c 10 http://localhost/

# Тест страницы форума
ab -n 500 -c 5 http://localhost/forum/
```

#### Используя wrk:

```bash
# Установка wrk
sudo apt install wrk

# Тест
wrk -t12 -c400 -d30s http://localhost/
```

### Тест базы данных

```sql
-- Количество запросов
SELECT count(*) FROM pg_stat_statements;

-- Самые медленные запросы
SELECT query, mean_exec_time 
FROM pg_stat_statements 
ORDER BY mean_exec_time DESC 
LIMIT 10;
```

### WebSocket нагрузка

Используйте инструмент типа `socket.io-client` для Python:

```python
import socketio

# Подключение множества клиентов
clients = []
for i in range(100):
    sio = socketio.Client()
    sio.connect('http://localhost')
    clients.append(sio)
```

## Тестирование совместимости

### Браузеры

Проверьте работу в:
- [ ] Chrome/Chromium (последняя версия)
- [ ] Firefox (последняя версия)
- [ ] Safari (если на Mac)
- [ ] Edge (последняя версия)
- [ ] Мобильные браузеры (Chrome Mobile, Safari Mobile)

### Разрешения экрана

Проверьте адаптивность на:
- [ ] Desktop (1920x1080)
- [ ] Laptop (1366x768)
- [ ] Tablet (768x1024)
- [ ] Mobile (375x667)

### Используйте DevTools:

```
1. F12 → Toggle device toolbar
2. Проверьте разные размеры
3. Проверьте touch events (если есть)
```

## Автоматизированное тестирование

### Структура тестов (пример)

Создайте `tests/` директорию:

```python
# tests/conftest.py
import pytest
from app import create_app, db

@pytest.fixture
def app():
    app = create_app('testing')
    with app.app_context():
        db.create_all()
        yield app
        db.session.remove()
        db.drop_all()

@pytest.fixture
def client(app):
    return app.test_client()

# tests/test_auth.py
def test_register(client):
    response = client.post('/auth/register', data={
        'username': 'testuser',
        'email': 'test@example.com',
        'password': 'password123',
        'confirm_password': 'password123'
    }, follow_redirects=True)
    assert response.status_code == 200
    assert b'testuser' in response.data

def test_login(client):
    # Создать пользователя
    # ...
    response = client.post('/auth/login', data={
        'email': 'test@example.com',
        'password': 'password123'
    }, follow_redirects=True)
    assert response.status_code == 200

# tests/test_forum.py
def test_create_topic(client):
    # Авторизоваться
    # ...
    response = client.post('/forum/topic/create', data={
        'title': 'Test Topic',
        'content': 'Test content...'
    }, follow_redirects=True)
    assert response.status_code == 200
    assert b'Test Topic' in response.data
```

### Запуск тестов:

```bash
pip install pytest pytest-cov
pytest tests/ -v
pytest tests/ --cov=app
```

## Чеклист перед релизом

### Функциональность
- [ ] Регистрация работает
- [ ] Вход/выход работает
- [ ] Создание топиков работает
- [ ] Создание постов работает
- [ ] Загрузка изображений работает
- [ ] WebSocket чат работает
- [ ] Профили работают
- [ ] Редактирование профиля работает
- [ ] Смена пароля работает

### Безопасность
- [ ] CSRF защита работает
- [ ] SQL injection не работает
- [ ] XSS не работает
- [ ] Защита маршрутов работает
- [ ] HTTPS настроен
- [ ] Security headers установлены

### Производительность
- [ ] Страницы загружаются < 2 секунд
- [ ] WebSocket подключается < 1 секунды
- [ ] Нет N+1 запросов к БД
- [ ] Статика кешируется

### UX
- [ ] Все формы имеют валидацию
- [ ] Все ошибки понятны пользователю
- [ ] Flash сообщения показываются
- [ ] Навигация интуитивна
- [ ] Адаптивный дизайн работает

### Инфраструктура
- [ ] Docker контейнеры запускаются
- [ ] Миграции применяются
- [ ] Backup работает
- [ ] Логи доступны
- [ ] SSL автообновляется

## Отчет об ошибках

При обнаружении ошибки создайте Issue со следующей информацией:

```
### Описание
Краткое описание проблемы

### Шаги воспроизведения
1. Перейти на ...
2. Нажать на ...
3. Заполнить ...

### Ожидаемое поведение
Что должно произойти

### Фактическое поведение
Что происходит на самом деле

### Скриншоты
Если применимо

### Окружение
- ОС: Ubuntu 22.04
- Браузер: Chrome 120
- Docker: 24.0
- Версия приложения: 1.0.0

### Логи
```
Вставьте логи здесь
```
```

